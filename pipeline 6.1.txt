pipeline {
    agent any
    
    stages {
        stage("Build") {
            steps {
                echo "We use Maven to build and compile Java-based programs to help keep a streamlined development process."
                // Add Maven build commands here if needed
            }
        }
        
        stage("Unit and Integration Tests") {
            steps {
                echo "We will use JUnit to test our code for any errors and integration errors as well."
                // Add JUnit test execution commands here if needed
            }
            post {
                success {
                    mail to: "alexjreid15@gmail.com",
                         subject: "Build Status Email",
                         body: "Build was successful."
                }
            }
        }
        
        stage("Code Analysis") {
            steps {
                echo "We will use SonarQube to analyze our code further and ensure it meets industry standards."
                // Add SonarQube analysis commands here if needed
            }
        }
        
        stage("Security Scan") {
            steps {
                echo "SonarQube can also perform security tests and vulnerability checks."
                // Add SonarQube security scan commands here if needed
            }
            post {
                success {
                    mail to: "alexjreid15@gmail.com",
                         subject: "Build Status Email",
                         body: "Build was successful."
                }
            }
        }
        
        stage("Deploy to Staging") {
            steps {
                echo "Deploying to staging server AWS EC2 instance."
                // Add deployment commands here if needed
            }
        }
        
        stage("Integration Tests on Staging") {
            steps {
                sleep 10
                echo "Running integration tests on staging to ensure it works like in production."
                // Add integration test commands here if needed
            }
        }
        
        stage("Deploy to Production") {
            steps {
                echo "Deploying to production server AWS EC2 instance."
                // Add deployment commands here if needed
            }
            post {
                always {
                    script {
                        def logFile = 'log.txt'
                        if (fileExists(logFile)) {
                            emailext (
                                to: "alexjreid15@gmail.com",
                                subject: "Build Status Email",
                                body: "The build was successful. Please find the log attached.",
                                attachmentsPattern: logFile
                            )
                        }
                        // No else block to handle case when logFile is not found
                    }
                }
            }
        }
    }
}
